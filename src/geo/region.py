from typing import Optional

# 简单关键词匹配的省份提取工具。
# 返回匹配到的省份名（不带“省/市/自治区”后缀），否则返回 None。

# 省份与直辖市关键词（长词优先，尽量减少误判）
REGION_PATTERNS = {
    "北京": ["北京市", "北京"],
    "天津": ["天津市", "天津"],
    "上海": ["上海市", "上海"],
    "重庆": ["重庆市", "重庆"],
    "河北": ["河北省", "河北"],
    "山西": ["山西省", "山西"],
    "辽宁": ["辽宁省", "辽宁"],
    "吉林": ["吉林省", "吉林"],
    "黑龙江": ["黑龙江省", "黑龙江"],
    "江苏": ["江苏省", "江苏"],
    "浙江": ["浙江省", "浙江"],
    "安徽": ["安徽省", "安徽"],
    "福建": ["福建省", "福建"],
    "江西": ["江西省", "江西"],
    "山东": ["山东省", "山东"],
    "河南": ["河南省", "河南"],
    "湖北": ["湖北省", "湖北"],
    "湖南": ["湖南省", "湖南"],
    "广东": ["广东省", "广东"],
    "海南": ["海南省", "海南"],
    "四川": ["四川省", "四川"],
    "贵州": ["贵州省", "贵州"],
    "云南": ["云南省", "云南"],
    "陕西": ["陕西省", "陕西"],
    "甘肃": ["甘肃省", "甘肃"],
    "青海": ["青海省", "青海"],
    "台湾": ["台湾省", "台湾"],  # 如不需要可后续移除
    "内蒙古": ["内蒙古自治区", "内蒙古"],
    "广西": ["广西壮族自治区", "广西自治区", "广西"],
    "西藏": ["西藏自治区", "西藏"],
    "宁夏": ["宁夏回族自治区", "宁夏自治区", "宁夏"],
    "新疆": ["新疆维吾尔自治区", "新疆自治区", "新疆"],
}


def extract_province(text: str) -> Optional[str]:
    """
    从文本中提取省份信息（关键词匹配）。
    - 命中返回省份名（如“四川”、“辽宁”）。
    - 未命中返回 None。
    - “中央/国家/全国”等不作为省份返回。
    """
    if not text:
        return None

    normalized = text.strip()
    # 优先匹配长关键词，避免短词误判（如“安”命中“安徽”）
    for province, keywords in REGION_PATTERNS.items():
        # 对关键词长度排序，长的先匹配
        for kw in sorted(keywords, key=len, reverse=True):
            if kw and kw in normalized:
                return province
    return None


__all__ = ["extract_province"]